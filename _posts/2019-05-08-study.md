---
layout: post
title: 가비지,힙덤프
subtitle: 
gh-repo: 
gh-badge: [star, fork, follow]
tags: [Study]
categories : [Other]
---

### 자바의 메모리 구조?


- JVM의 메모리 구조

<img src="https://t1.daumcdn.net/cfile/tistory/2540294C5654207F26">

- 실행될 클래스 파일을 메모리에 로드 후 초기화 작업 수행  
- 메소드와 클래스변수들을 해당 메모리 영역애 배치  
- 클래스로드가 끝난 후 JVM은 main 메소드를 찾아 지역변수, 객체변수, 참조변수를 스택에 쌓음  
- 다음 라인을 진행하면서 상황에 맞는 작업 수행(함수 호출, 객체 할당 등)  

- Class Loader: JVM내로 클래스를 로드하고 링크를 통해 배치하는 작업을 수행하는 모듈로써 런타임시 동적으로 클래스를 로드한다.
- Execution Engine: Class Loader를 통해 JVM 내의 런타임 데이터 영역에 배치된 바이트 코드를 실행한다. 이 때, Execution - Engine은 자바 바이트 코드를 명령어 단위로 읽어서 실행한다.
- Garbage Collector: JVM은 Garbage Collector를 통해 메모리 관리 기능을 자동으로 수행한다. 애플리케이션이 생성한 객체의 생존 여부를 판단하여 더 이상 사용되지 않는 객체를 해제하는 방식으로 메모리를 자동 관리한다.
- Runtime Data Areas: JVM이 운영체제 위에서 실행되면서 할당받는 메모리 영역이다. Class Loader에서 준비한 데이터들을 보관하는 저장소이다.






### 가비지 컬렉터란?





### 힙덤프란?


- 힙은 ?
Heap이란 Java에서 사용하는 object들을 저장하는 공간입니다. 물론 Heap이란 용어가 꼭 Java에서만 사용되는 용어는 아닙니다.
Unix에서 Native 즉 C에서 malloc()으로 할당되는 메모리 영역을 Heap(예전에 공부할때 자유저장소 라고도 했었죠 ^^)이라고 말합니다


JVM이 관리하는 프로그램 상에서 데이터를 저장하기 위해 런타임 시 동적으로 할당하여 사용하는 영역이다.
New 연산자로 생성된 객체 또는 객체(인스턴스)와 배열을 저장한다.
힙 영역에 생성된 객체와 배열은 스택 영역의 변수나 다른 객체의 필드에서 참조한다.
참조하는 변수나 필드가 없다면 의미 없는 객체가 되어 GC의 대상이 된다.
힙 영역의 사용기간 및 스레드 공유 범위
객체가 더 이상 사용되지 않거나 명시적으로 null 선언 시
GC(Garbage Collection) 대상
구성 방식이나 GC 방법은 JVM 벤더마다 다를 수 있다.
모든 스레드에서 공유한다.

- new 연산자로 생성된 객체와 배열을 저장하는 공간
- 클래스 영역에 로드된 클래스만 생성가능
- Garbage Collector를 통해 메모리 반환

i) Permanent Generation
- 생성된 객체들의 정보의 주소 값이 저장된 공간

ii) New Area
- Eden : 객체들이 최초로 생성되는 공간
- Survivor : Eden에서 참조되는 객체들이 저장되는 공간

iii) Old Area : New Area에서 일정시간이상 참조되고 있는 객체들이 저장되는 공간




힙덤프란?

 Java 프로그램은 처음 시작할 때 사용할 Heap 영역을 가지고 있습니다. 이 영역이 부족하게 되면 Out Of Memory Error가 에레를 발생시킵니다. 그로인해 heap dump가 만들어 지게 됩니다.

발생시키며 종료하는 법?

Heap dump를 생성하기 위해서는 Java 프로세스에 Ctrl+Break 또는 SIGQUIT Signal을 발생시켜 생성할 수 있습니다. 즉 Thread dump 생성과 동일한 방법입니다.

리눅스 : kill -3 [PID]
윈도우 : Ctrl + Break

MemoryError : out of memory가 발생시에 힙덤프를 현재 실행 디렉토리에 생성한다.

-XX:HeapDumpPath=힘덤프를 생성할 경로/힙덤프이름.hprof : 지정한 경로에 생성한다.

http://blog.naver.com/PostView.nhn?blogId=bumsukoh&logNo=110123438564&redirect=Dlog&widgetTypeCall=true



### JVM 을 힙덤프가 남게 죽이는 법은?