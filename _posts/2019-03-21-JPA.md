---
layout: post
title: JPA cascade
subtitle:
gh-repo:
gh-badge: [star,fork,follow]
tags: [JAVA]
categories : [Java]
---

* @Entity - 이 클래스를 테이블과 매핑한다고 Jpa에게 알려준다.

* @Table - 엔티티클래스에 매핑할 테이블 정보를 알려준다.

* @Id - 기본 키(primary key)에 매핑한다.

* @Column - 필드를 칼럼에 매핑

* @ManyToOne, @JoinColumn - 연관관계 매핑
---

* JPA를 사용 시 문제는 검색 쿼리에서 발생

    - 이때 사용되는것이JPQL
    JPQL은 엔티티객체를 대상으로 쿼리한다(SQL은 데이터베이스 테이블을 대상으로 쿼리한다)

---

* 영속성 컨텍스트란?
    - 엔티티를 영구 저장하는 환경
    - 예로 persist()메소드는 엔티티 매니저를 사용해서 회원엔티티를 영속성 컨텍스트에 저장한다.

* 엔티티 생명주기
    - 비영속 - 영속성 컨텍스트와 관계없는 상태
    - 영속 - 영속성 컨텍스트에 저장된 상태( 영속성 컨텍스트에 의해 관리된다)
    - 준영속 - 영속성 컨텍스트에 저장되어있다가 분리된 상태
    - 삭제 - 삭제된 상태

* 영속성 컨텍스트 특징 
    - 영속 상태는 식별자 값이 반드시 있어야한다.
    - JPA는 트랜잭션에 커밋하는 순간 영속성 컨텍스트에 새로 저장된 엔티티를 데이터베이스에 반영(플러시))
    - 장점 
        1. 1차캐시
        2. 동일성 보장
        3. 트랜잭션을 지원하는 쓰기 지연
        4. 변경 감지
        5. 지연 로딩

---

* CASCADE - 특정 엔티티를 영속상태로 만들 때 연관된 엔티티도 함꼐 영속 상태로 만들떄 사용
    - 영속성 전이를 사용하면 부모 엔티티를 저장할때 자식엔티티도 함꼐 저장할 수 있다.
    - JPA에서 엔티티를 저장할 떄 연관된 모든 엔티티는 영속상태여야 한다.
    - 예) @OneToMany(mappedBy = "parent", cascade - CascadeType.PERSIST) - 부모를 영속화 할떄 연관된 자식도 함께 영속
    - 저장한 부모와 자식 엔티티를 모두 제거하려면 각각의 엔티티를 하나씩 제거해야 한다.
    - 예) em.remove(findChild1); / em.remove(findChild2); / em.remove(findChild3); / em.remove(findParent);
    - 만약 CascadeType.REMOVE를 설정하지않고 이코드를 실행하면 부모엔티티만 삭제되는데 부모로우를 삭제하는 순간 자식테이블에 걸려있는 외래키 제약조건을 인해 DB에 외래키 무결성 예외가 발생한다.

* CASCADE의 종류
    - ALL - 모두 적용
    - PERSIST - 영속
    - MERGE - 병합
    - REMOVE - 삭제
    - REFRESH - REFRESH
    - DETACH - DETACH

